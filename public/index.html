<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lua ã‚³ãƒ¼ãƒ‰ãƒ„ãƒ¼ãƒ« by YAJU</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Noto+Sans+JP:wght@300;400;700&display=swap');
:root{
  --bg:#060810;--panel:#0d1117;
  --obf:#ff3c5a;--obf-glow:rgba(255,60,90,.5);
  --deobf:#00e5ff;--deobf-glow:rgba(0,229,255,.5);
  --text:#d0d8e8;--muted:#556070;--border:#1e2535;
}
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:'Noto Sans JP',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;overflow-x:hidden}
body::before{content:'';position:fixed;inset:0;
  background-image:linear-gradient(rgba(0,229,255,.03) 1px,transparent 1px),
    linear-gradient(90deg,rgba(0,229,255,.03) 1px,transparent 1px);
  background-size:40px 40px;pointer-events:none;z-index:0}
.wrapper{position:relative;z-index:1;max-width:1000px;margin:0 auto;padding:28px 20px 60px}
/* â”€â”€ header â”€â”€ */
.site-header{text-align:center;margin-bottom:36px}
.site-title{font-family:'Share Tech Mono',monospace;font-size:clamp(20px,4vw,34px);
  letter-spacing:.12em;color:#fff;text-shadow:0 0 20px rgba(255,255,255,.25);margin-bottom:6px}
.site-sub{font-size:.82em;color:var(--muted);letter-spacing:.08em}
/* â”€â”€ tab â”€â”€ */
.mode-selector{display:flex;background:var(--panel);border:1px solid var(--border);
  border-radius:10px;overflow:hidden;margin-bottom:30px;position:relative}
.mode-btn{flex:1;padding:18px 12px;border:none;background:transparent;color:var(--muted);
  font-family:'Share Tech Mono',monospace;font-size:clamp(13px,2.5vw,17px);letter-spacing:.1em;
  cursor:pointer;transition:all .3s;position:relative;z-index:1}
.mode-btn::after{content:'';position:absolute;inset:0;opacity:0;transition:opacity .3s}
.mode-btn.obf::after{background:linear-gradient(135deg,rgba(255,60,90,.12),transparent)}
.mode-btn.deobf::after{background:linear-gradient(135deg,rgba(0,229,255,.12),transparent)}
.mode-btn.active.obf{color:var(--obf);text-shadow:0 0 12px var(--obf-glow)}
.mode-btn.active.deobf{color:var(--deobf);text-shadow:0 0 12px var(--deobf-glow)}
.mode-btn.active::after{opacity:1}
.mode-divider{width:1px;background:var(--border);flex-shrink:0}
.mode-indicator{position:absolute;bottom:0;left:0;height:3px;width:50%;
  border-radius:3px 3px 0 0;transition:all .4s cubic-bezier(.4,0,.2,1)}
.mode-indicator.obf{background:var(--obf);box-shadow:0 0 12px var(--obf-glow)}
.mode-indicator.deobf{background:var(--deobf);box-shadow:0 0 12px var(--deobf-glow);left:50%}
/* â”€â”€ panels â”€â”€ */
.tool-panel{display:none}.tool-panel.active{display:block}
/* â”€â”€ card â”€â”€ */
.card{background:var(--panel);border:1px solid var(--border);border-radius:10px;
  padding:22px;margin-bottom:20px;position:relative;overflow:hidden}
.card::before{content:'';position:absolute;top:0;left:0;right:0;height:2px}
.obf-panel .card::before{background:linear-gradient(90deg,transparent,var(--obf),transparent)}
.deobf-panel .card::before{background:linear-gradient(90deg,transparent,var(--deobf),transparent)}
.card-label{font-family:'Share Tech Mono',monospace;font-size:.78em;letter-spacing:.14em;margin-bottom:14px}
.obf-panel .card-label{color:var(--obf)}
.deobf-panel .card-label{color:var(--deobf)}
/* â”€â”€ file â”€â”€ */
.file-btn{display:block;background:#0a0f18;color:#aaa;padding:14px;border-radius:6px;
  cursor:pointer;border:1px dashed var(--border);transition:.25s;text-align:center;
  font-size:.9em;margin-bottom:10px}
.obf-panel .file-btn:hover{border-color:var(--obf);color:var(--obf)}
.deobf-panel .file-btn:hover{border-color:var(--deobf);color:var(--deobf)}
.file-name{font-size:.8em;color:var(--muted);text-align:right;margin-bottom:8px}
input[type="file"]{display:none}
/* â”€â”€ textarea â”€â”€ */
textarea{width:100%;background:#060a10;color:#41e882;border:1px solid var(--border);
  border-radius:6px;font-family:'Share Tech Mono',monospace;padding:14px;
  resize:vertical;font-size:13px;line-height:1.6;transition:border-color .25s}
textarea:focus{outline:none}
.obf-panel textarea:focus{border-color:rgba(255,60,90,.4)}
.deobf-panel textarea:focus{border-color:rgba(0,229,255,.4)}
/* â”€â”€ range â”€â”€ */
.range-row{display:flex;align-items:center;gap:14px;margin:10px 0 4px}
input[type="range"]{flex:1;height:4px;border-radius:4px;background:var(--border);
  cursor:pointer;-webkit-appearance:none;appearance:none}
input[type="range"]::-webkit-slider-thumb{-webkit-appearance:none;width:16px;height:16px;
  border-radius:50%;cursor:pointer}
.obf-panel input[type="range"]{accent-color:var(--obf)}
.obf-panel input[type="range"]::-webkit-slider-thumb{background:var(--obf)}
.range-val{font-family:'Share Tech Mono',monospace;min-width:44px;text-align:right;color:var(--obf)}
/* â”€â”€ checks â”€â”€ */
.checks-grid{display:flex;flex-wrap:wrap;gap:10px 24px}
.chk-label{display:flex;align-items:center;gap:8px;cursor:pointer;font-size:.88em;color:#bbb;transition:color .2s}
.chk-label:hover{color:#fff}
.chk-label input{transform:scale(1.2)}
.obf-panel .chk-label input{accent-color:var(--obf)}
/* â”€â”€ info â”€â”€ */
.warn{background:rgba(255,152,0,.08);border-left:3px solid #ff9800;padding:10px 14px;
  border-radius:4px;font-size:.82em;color:#ffb74d;margin-top:8px}
.info-banner{background:rgba(0,229,255,.05);border:1px solid rgba(0,229,255,.15);
  border-radius:8px;padding:16px;margin-bottom:16px;font-size:.85em;line-height:1.8;color:#99d6e0}
.info-banner strong{color:var(--deobf)}
.info-banner code{font-family:'Share Tech Mono',monospace;background:rgba(0,229,255,.1);
  padding:1px 5px;border-radius:3px}
.lite-info{display:none;margin-top:10px;font-size:.82em;color:#80deea;padding:8px 12px;
  background:rgba(0,229,255,.07);border-left:3px solid var(--deobf);border-radius:4px}
/* â”€â”€ buttons â”€â”€ */
.main-btn{width:100%;padding:17px;border:none;border-radius:8px;
  font-family:'Share Tech Mono',monospace;font-size:clamp(14px,2.5vw,18px);
  letter-spacing:.1em;cursor:pointer;transition:.3s;margin-top:6px}
.main-btn:disabled{opacity:.4;cursor:not-allowed;transform:none!important}
.obf-panel .main-btn{background:linear-gradient(135deg,var(--obf),#b71c1c);color:#fff;
  box-shadow:0 4px 20px rgba(255,60,90,.35)}
.obf-panel .main-btn:not(:disabled):hover{transform:translateY(-2px);box-shadow:0 6px 24px rgba(255,60,90,.55)}
.deobf-panel .main-btn{background:linear-gradient(135deg,var(--deobf),#006064);color:#000;
  box-shadow:0 4px 20px rgba(0,229,255,.3)}
.deobf-panel .main-btn:not(:disabled):hover{transform:translateY(-2px);box-shadow:0 6px 24px rgba(0,229,255,.5)}
/* â”€â”€ progress â”€â”€ */
.progress-wrap{height:4px;background:#0a0f18;border-radius:4px;margin:14px 0;overflow:hidden;display:none}
.progress-fill{height:100%;width:0;border-radius:4px;transition:width .15s linear}
.obf-panel .progress-fill{background:var(--obf);box-shadow:0 0 8px var(--obf-glow)}
.deobf-panel .progress-fill{background:var(--deobf);box-shadow:0 0 8px var(--deobf-glow)}
/* â”€â”€ loader â”€â”€ */
.loader{border:3px solid #1e2535;border-top:3px solid var(--deobf);border-radius:50%;
  width:28px;height:28px;animation:spin 1s linear infinite;margin:10px auto;display:none}
@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
/* â”€â”€ status â”€â”€ */
.status-line{text-align:center;font-size:.9em;font-family:'Share Tech Mono',monospace;
  min-height:1.6em;padding:6px 0;letter-spacing:.06em}
/* â”€â”€ copy btn â”€â”€ */
.copy-btn{width:100%;margin-top:10px;padding:11px;border:none;border-radius:6px;
  font-family:'Share Tech Mono',monospace;font-size:.88em;letter-spacing:.08em;cursor:pointer;transition:.2s}
.obf-panel .copy-btn{background:#222c3a;color:#eee}
.obf-panel .copy-btn:hover{background:var(--obf);color:#fff}
.deobf-panel .copy-btn{background:#0a1e22;color:#eee}
.deobf-panel .copy-btn:hover{background:var(--deobf);color:#000}
/* â”€â”€ discord â”€â”€ */
.discord-btn{position:fixed;bottom:28px;right:28px;width:54px;height:54px;background:#5865F2;
  border-radius:50%;display:flex;align-items:center;justify-content:center;
  box-shadow:0 4px 16px rgba(88,101,242,.45);transition:.3s;text-decoration:none;z-index:100}
.discord-btn:hover{transform:translateY(-4px) scale(1.08)}
.discord-btn svg{width:28px;height:28px;fill:#fff}
small.hint{display:block;color:var(--muted);font-size:.78em;margin-top:5px}
::-webkit-scrollbar{width:6px}
::-webkit-scrollbar-track{background:#0a0f18}
::-webkit-scrollbar-thumb{background:#2a3550;border-radius:3px}
</style>
</head>
<body>
<div class="wrapper">
  <header class="site-header">
    <div class="site-title">[ LUA CODE TOOL :: YAJU ]</div>
    <div class="site-sub">OBFUSCATOR &amp; DEOBFUSCATOR</div>
  </header>

  <!-- ã‚¿ãƒ–åˆ‡æ›¿ -->
  <div class="mode-selector">
    <button class="mode-btn obf active" id="btnModeObf">ğŸ”’ é›£èª­åŒ–</button>
    <div class="mode-divider"></div>
    <button class="mode-btn deobf" id="btnModeDeobf">ğŸ”“ è§£èª­ (Deobfuscator)</button>
    <div class="mode-indicator obf" id="modeIndicator"></div>
  </div>

  <!-- â•â• é›£èª­åŒ–ãƒ‘ãƒãƒ« â•â• -->
  <div class="tool-panel obf-panel active" id="panelObf">
    <div class="card">
      <div class="card-label">[ 01 ] IMPORT CODE</div>
      <label for="obfFileInput" class="file-btn">ğŸ“‚ ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ (.lua / .txt)</label>
      <input type="file" id="obfFileInput" accept=".lua,.txt">
      <div id="obfFileName" class="file-name">ãƒ•ã‚¡ã‚¤ãƒ«æœªé¸æŠ</div>
      <textarea id="obfInput" rows="8" placeholder="ã“ã“ã«Luaã‚³ãƒ¼ãƒ‰ã‚’è²¼ã‚Šä»˜ã‘ã‚‹ã‹ã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚“ã§ãã ã•ã„..."></textarea>
    </div>

    <div class="card">
      <div class="card-label">[ 02 ] ENCRYPTION LAYERS</div>
      <div class="range-row">
        <span style="font-size:.82em;color:#888">Base64å±¤æ•°</span>
        <input type="range" id="b64Layers" min="1" max="50" value="5">
        <span class="range-val" id="layerVal">5</span>
      </div>
      <div id="layerWarning" class="warn" style="display:none">âš ï¸ 30å±¤ä»¥ä¸Šã¯å‡¦ç†ã«æ™‚é–“ãŒã‹ã‹ã‚Šã¾ã™</div>
      <small class="hint">æ¨å¥¨: 5ã€œ15å±¤ ï¼ æœ€å¤§50å±¤</small>

      <div class="card-label" style="margin-top:18px">[ 03 ] JUNK CODE INTENSITY</div>
      <div class="range-row">
        <span style="font-size:.82em;color:#888">ãƒ€ãƒŸãƒ¼ã‚³ãƒ¼ãƒ‰</span>
        <input type="range" id="junkIntensity" min="1" max="500" value="200">
        <span class="range-val" id="junkVal">200</span>
      </div>
      <small class="hint">æ¨å¥¨: 150ã€œ300 ï¼ æœ€å¤§500</small>
    </div>

    <div class="card">
      <div class="card-label">[ 04 ] ADVANCED OPTIONS</div>
      <div class="checks-grid">
        <label class="chk-label"><input type="checkbox" id="chkXor" checked> XORé›£èª­åŒ–</label>
        <label class="chk-label"><input type="checkbox" id="chkShuffle" checked> ã‚·ãƒ£ãƒƒãƒ•ãƒ«</label>
        <label class="chk-label"><input type="checkbox" id="chkFlat" checked> åˆ¶å¾¡ãƒ•ãƒ­ãƒ¼å¹³å¦åŒ–</label>
        <label class="chk-label" style="color:var(--obf)"><input type="checkbox" id="chkAntiDump" checked> ã‚¢ãƒ³ãƒãƒ€ãƒ³ãƒ‘ãƒ¼</label>
        <label class="chk-label" style="color:#ff9800"><input type="checkbox" id="chkSaltEncode" checked> å‹•çš„ã‚½ãƒ«ãƒˆã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰</label>
        <label class="chk-label" style="color:#ff9800"><input type="checkbox" id="chkNumExpr" checked> æ•°å€¤â†’æ•°å¼å½è£…</label>
        <label class="chk-label" style="color:#ff9800"><input type="checkbox" id="chkJunkFunc" checked> ã‚´ãƒŸé–¢æ•°æ³¨å…¥</label>
        <label class="chk-label" style="color:var(--deobf)"><input type="checkbox" id="chkLite"> è»½é‡åŒ–ãƒ¢ãƒ¼ãƒ‰</label>
      </div>
      <div class="lite-info" id="liteModeInfo">è»½é‡åŒ–ãƒ¢ãƒ¼ãƒ‰: ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã‚’è‡ªå‹•çš„ã«å°ã•ãã—ã¾ã™</div>
    </div>

    <button class="main-btn" id="btnObfuscate">âš¡ é›£èª­åŒ–ã‚’å®Ÿè¡Œ</button>
    <div class="progress-wrap" id="obfProgress"><div class="progress-fill" id="obfProgressFill"></div></div>
    <div class="status-line" id="obfStatus" style="color:#4db6ac">READY</div>

    <div class="card">
      <div class="card-label">[ 05 ] OUTPUT</div>
      <textarea id="obfOutput" rows="8" readonly placeholder="é›£èª­åŒ–ã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™..."></textarea>
      <button class="copy-btn" id="btnObfCopy">ğŸ“‹ ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼</button>
    </div>
  </div>

  <!-- â•â• è§£èª­ãƒ‘ãƒãƒ« â•â• -->
  <div class="tool-panel deobf-panel" id="panelDeobf">
    <div class="info-banner">
      <strong>Dynamic Deobfuscator</strong> â€” ã‚µãƒ¼ãƒãƒ¼å´ã§Luaã‚’å®Ÿéš›ã«å®Ÿè¡Œã—ã€<code>loadstring()</code>ã‚’ãƒ•ãƒƒã‚¯ã—ã¦å…ƒã‚³ãƒ¼ãƒ‰ã‚’ã‚­ãƒ£ãƒ—ãƒãƒ£ã—ã¾ã™ã€‚<br>
      âœ¨ WeAreDevs / YAJU / ãã®ä»–ã®é›£èª­åŒ–ã«å¯¾å¿œ &nbsp;ï½œ&nbsp; ğŸš€ å‹•çš„å®Ÿè¡Œæ–¹å¼
    </div>
    <div class="card">
      <div class="card-label">[ 01 ] IMPORT OBFUSCATED CODE</div>
      <label for="deobfFileInput" class="file-btn">ğŸ“‚ é›£èª­åŒ–æ¸ˆã¿ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ (.lua / .txt)</label>
      <input type="file" id="deobfFileInput" accept=".lua,.txt">
      <div id="deobfFileName" class="file-name">ãƒ•ã‚¡ã‚¤ãƒ«æœªé¸æŠ</div>
      <textarea id="deobfInput" rows="8" placeholder="é›£èª­åŒ–ã•ã‚ŒãŸLuaã‚³ãƒ¼ãƒ‰ã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„..."></textarea>
    </div>
    <button class="main-btn" id="btnDeobfuscate">ğŸ”¬ è§£èª­ã‚’å®Ÿè¡Œ</button>
    <div class="loader" id="deobfLoader"></div>
    <div class="status-line" id="deobfStatus" style="color:var(--deobf)">READY</div>
    <div class="card">
      <div class="card-label">[ 02 ] DEOBFUSCATED OUTPUT</div>
      <textarea id="deobfOutput" rows="10" readonly placeholder="è§£èª­ã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™..."></textarea>
      <button class="copy-btn" id="btnDeobfCopy">ğŸ“‹ ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼</button>
    </div>
  </div>
</div>

<a href="https://discord.gg/qHmudNCUJ9" target="_blank" class="discord-btn" title="Discordã‚µãƒ¼ãƒãƒ¼ã«å‚åŠ ">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 127.14 96.36">
    <path d="M107.7,8.07A105.15,105.15,0,0,0,81.47,0a72.06,72.06,0,0,0-3.36,6.83A97.68,97.68,0,0,0,49,6.83,72.37,72.37,0,0,0,45.64,0,105.89,105.89,0,0,0,19.39,8.09C2.79,32.65-1.71,56.6.54,80.21h0A105.73,105.73,0,0,0,32.71,96.36,77.7,77.7,0,0,0,39.6,85.25a68.42,68.42,0,0,1-10.85-5.18c.91-.66,1.8-1.34,2.66-2a75.57,75.57,0,0,0,64.32,0c.87.71,1.76,1.39,2.66,2a68.68,68.68,0,0,1-10.87,5.19,77,77,0,0,0,6.89,11.1A105.25,105.25,0,0,0,126.6,80.22h0C129.24,52.84,122.09,29.11,107.7,8.07ZM42.45,65.69C36.18,65.69,31,60,31,53s5-12.74,11.43-12.74S54,46,53.89,53,48.84,65.69,42.45,65.69Zm42.24,0C78.41,65.69,73.25,60,73.25,53s5-12.74,11.44-12.74S96.23,46,96.12,53,91.08,65.69,84.69,65.69Z"/>
  </svg>
</a>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ã‚¿ãƒ–åˆ‡æ›¿
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function switchMode(mode) {
  const isObf = mode === 'obf';
  document.getElementById('btnModeObf').classList.toggle('active', isObf);
  document.getElementById('btnModeDeobf').classList.toggle('active', !isObf);
  document.getElementById('panelObf').classList.toggle('active', isObf);
  document.getElementById('panelDeobf').classList.toggle('active', !isObf);
  document.getElementById('modeIndicator').className = 'mode-indicator ' + mode;
}
document.getElementById('btnModeObf').addEventListener('click', () => switchMode('obf'));
document.getElementById('btnModeDeobf').addEventListener('click', () => switchMode('deobf'));

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const byId = id => document.getElementById(id);
const sleep = ms => new Promise(r => setTimeout(r, ms));

function randomString(n) {
  const c = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_";
  let s = "";
  for (let i = 0; i < n; i++) s += c[Math.floor(Math.random() * c.length)];
  return s;
}

function makeSalt(len) {
  const alpha = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";
  let s = "";
  for (let i = 0; i < len; i++) s += alpha[Math.floor(Math.random() * alpha.length)];
  return s;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼UIæ›´æ–°
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function updateObfUI() {
  const l = parseInt(byId('b64Layers').value);
  byId('layerVal').innerText = l;
  byId('layerWarning').style.display = l >= 30 ? 'block' : 'none';
  byId('junkVal').innerText = byId('junkIntensity').value;
}
byId('b64Layers').addEventListener('input', updateObfUI);
byId('junkIntensity').addEventListener('input', updateObfUI);
byId('chkLite').addEventListener('change', function() {
  byId('liteModeInfo').style.display = this.checked ? 'block' : 'none';
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ»ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function setObfStatus(msg, type) {
  const el = byId('obfStatus');
  el.innerText = msg;
  el.style.color = type === 'error' ? '#ff3c5a' : type === 'process' ? '#bb86fc' : '#4db6ac';
}
function updateObfProgress(pct) {
  byId('obfProgress').style.display = 'block';
  byId('obfProgressFill').style.width = pct + '%';
}
function setDeobfStatus(msg, type) {
  const el = byId('deobfStatus');
  el.innerText = msg;
  el.style.color = type === 'error' ? '#ff3c5a' : type === 'process' ? '#bb86fc' : '#00e5ff';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function handleFile(inputId, displayId, textareaId) {
  const file = byId(inputId).files[0];
  if (!file) return;
  byId(displayId).innerText = `é¸æŠä¸­: ${file.name} (${(file.size / 1024).toFixed(1)} KB)`;
  const r = new FileReader();
  r.onload = e => { byId(textareaId).value = e.target.result; };
  r.onerror = () => alert('ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿å¤±æ•—');
  r.readAsText(file);
}
byId('obfFileInput').addEventListener('change', () => handleFile('obfFileInput', 'obfFileName', 'obfInput'));
byId('deobfFileInput').addEventListener('change', () => handleFile('deobfFileInput', 'deobfFileName', 'deobfInput'));

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  å¤‰æ•°åç”Ÿæˆ (ãƒ›ãƒ¢ã‚°ãƒªãƒ•)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function generateVarName(lite) {
  if (lite) {
    const t = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_";
    return t[Math.floor(Math.random() * t.length)];
  }
  const starts = ["I", "l", "O", "Il", "lI", "OI", "IO", "lO", "Ol"];
  let e = starts[Math.floor(Math.random() * starts.length)];
  const chars = ["I", "l", "O", "_", "1", "0"];
  const len = 10 + Math.floor(8 * Math.random());
  for (let a = 0; a < len; a++) e += chars[Math.floor(Math.random() * chars.length)];
  return e;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  æ•°å€¤ã‚’æ•°å¼ã«å½è£…
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function numToExpr(n) {
  const r = Math.random();
  if (r < 0.25 && n > 1) {
    for (let a = 2; a <= Math.min(20, n); a++) {
      if (n % a === 0) return `(${a}*${n / a})`;
    }
  }
  if (r < 0.5) {
    const off = Math.floor(Math.random() * 50) + 1;
    return `(${n + off}-${off})`;
  }
  if (r < 0.75) return `(math.floor(${n * 10}/10))`;
  const x = Math.floor(Math.random() * 255) + 1;
  return `(bit32 and bit32.bxor(${n ^ x},${x}) or ${n})`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  å‹•çš„ã‚½ãƒ«ãƒˆã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ (å®Ÿè¡Œæ™‚ã«è‡ªå‹•æ±ºå®š)
//  ææ¡ˆã®é€šã‚Š: saltæ–‡å­—åˆ—ã¯å®Ÿè¡Œæ™‚ã«ãƒ©ãƒ³ãƒ€ãƒ ç”Ÿæˆ â†’ 
//  ãã®saltã‹ã‚‰å¼•ãé‡(offset)ã‚‚å‹•çš„ã«æ±ºã¾ã‚‹
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// æ–¹å¼A: è‹±èªã‚½ãƒ«ãƒˆ + æ•°å€¤ã‚ªãƒ•ã‚»ãƒƒãƒˆï¼ˆå¼•ãé‡ãŒå‹•çš„ï¼‰
function strToSaltedDecimal(str) {
  const salt = makeSalt(3 + Math.floor(Math.random() * 4));
  const offset = salt.split('').reduce((a, c) => a + c.charCodeAt(0), 0) % 128;
  const codes = str.split('').map(c => c.charCodeAt(0) - offset);
  // Luaå´: saltã‹ã‚‰åŒã˜offsetã‚’å†è¨ˆç®—ã—ã¦åŠ ç®—ã§å¾©å…ƒ
  return `(function()` +
    `local _s="${salt}";` +
    `local _o=0;` +
    `for i=1,#_s do _o=_o+string.byte(_s,i) end;` +
    `_o=_o%128;` +
    `return string.char(${codes.map(v => `_o+${v}`).join(',')})` +
    `end)()`;
}

// æ–¹å¼B: ã‚½ãƒ«ãƒˆXORï¼ˆå„æ–‡å­—ã‚³ãƒ¼ãƒ‰ã‚’å¾ªç’°XORï¼‰
function strToSaltXor(str) {
  const salt = makeSalt(4 + Math.floor(Math.random() * 4));
  const saltCodes = salt.split('').map(c => c.charCodeAt(0));
  const encoded = str.split('').map((c, i) => c.charCodeAt(0) ^ saltCodes[i % saltCodes.length]);
  return `(function()` +
    `local _k={string.byte("${salt}",1,${salt.length})};` +
    `local _e={${encoded.join(',')}};` +
    `local _r={};` +
    `for i=1,#_e do _r[i]=string.char(` +
      `bit32 and bit32.bxor(_e[i],_k[(i-1)%#_k+1])` +
      ` or ((_e[i]+_k[(i-1)%#_k+1])%256)` +
    `) end;` +
    `return table.concat(_r)` +
    `end)()`;
}

// æ–¹å¼C: ç´ æ•°ã®ç©/å’Œã«åˆ†è§£
const PRIMES = [2,3,5,7,11,13,17,19,23,29,31,37,41,43,47];
function factorize(n) {
  for (let i = 0; i < PRIMES.length; i++) {
    for (let j = i; j < PRIMES.length; j++) {
      if (PRIMES[i] * PRIMES[j] === n) return `${PRIMES[i]}*${PRIMES[j]}`;
    }
  }
  for (let a = 2; a <= 15; a++) {
    const q = Math.floor(n / a), r = n % a;
    if (r === 0) return `${a}*${q}`;
    if (q > 0 && q < 256 && r > 0) return `${a}*${q}+${r}`;
  }
  return String(n);
}
function strToPrimeFactored(str) {
  const codes = str.split('').map(c => `(${factorize(c.charCodeAt(0))})`);
  return `string.char(${codes.join(',')})`;
}

// æ–¹å¼D: é€†é †+ROT13
function rot13c(c) {
  const code = c.charCodeAt(0);
  if (code >= 65 && code <= 90) return String.fromCharCode(((code - 65 + 13) % 26) + 65);
  if (code >= 97 && code <= 122) return String.fromCharCode(((code - 97 + 13) % 26) + 97);
  return c;
}
function strToReverseRot13(str) {
  const rot13ed = str.split('').reverse().map(rot13c).join('');
  const escaped = rot13ed.replace(/\\/g,'\\\\').replace(/"/g,'\\"');
  return `(function()` +
    `local _e={string.byte("${escaped}",1,${rot13ed.length})};` +
    `local _r={};` +
    `for i=1,#_e do ` +
      `local c=_e[i];` +
      `if c>=65 and c<=90 then c=((c-65+13)%26)+65 ` +
      `elseif c>=97 and c<=122 then c=((c-97+13)%26)+97 end;` +
      `table.insert(_r,1,string.char(c)) ` +
    `end;` +
    `return table.concat(_r)` +
    `end)()`;
}

// ãƒ©ãƒ³ãƒ€ãƒ ã«4æ–¹å¼ã‹ã‚‰é¸æŠ
function strToEncodedChar(str) {
  if (!str || str.length === 0) return '""';
  const m = Math.floor(Math.random() * 4);
  try {
    if (m === 0) return strToSaltedDecimal(str);
    if (m === 1) return strToSaltXor(str);
    if (m === 2) return strToPrimeFactored(str);
    return strToReverseRot13(str);
  } catch(e) {
    return strToPrimeFactored(str); // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
  }
}
function strToChar(str) {
  const c = [];
  for (let i = 0; i < str.length; i++) c.push(str.charCodeAt(i));
  return `string.char(${c.join(',')})`;
}
function bytesToBase64(t) {
  return btoa(Array.from(t, t => String.fromCodePoint(t)).join(""));
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ã‚´ãƒŸé–¢æ•°ç”Ÿæˆ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function generateJunkFunction(lite) {
  const fn = generateVarName(lite);
  const a = generateVarName(lite), b = generateVarName(lite), c = generateVarName(lite);
  const patterns = [
    `local function ${fn}(${a},${b})local ${c}=0;for i=1,${numToExpr(Math.floor(Math.random()*10)+1)} do ${c}=${c}+${a}*i end;return ${c}+${b} end`,
    `local function ${fn}(${a})local ${b}={};for i=1,#${a} do ${b}[i]=string.byte(${a},i)+${numToExpr(Math.floor(Math.random()*10)+1)} end;return table.concat(${b},",") end`,
    `local function ${fn}(${a},${b},${c})if ${a}>${b} then return ${a}-${c} elseif ${b}>${c} then return ${b}*2 else return ${c} end end`,
    `local ${fn};do local ${a}=${numToExpr(Math.floor(Math.random()*100)+1)};local ${b}=${numToExpr(Math.floor(Math.random()*100)+1)};${fn}=function()return ${a}+${b} end end`,
  ];
  return patterns[Math.floor(Math.random() * patterns.length)] + (lite ? ';' : ';\n');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ã‚¸ãƒ£ãƒ³ã‚¯ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function generateMassiveJunkCode(count, lite, opts) {
  let e = "";
  const useSalt = opts && opts.useSaltEncode;
  const useNum  = opts && opts.useNumExpr;
  const encStr  = s => useSalt ? strToEncodedChar(s) : strToChar(s);
  const encNum  = n => useNum  ? numToExpr(n) : String(n);

  const patterns = [
    () => `local ${generateVarName(lite)}=${encNum(Math.floor(Math.random()*9999)+1)};${lite?'':'\n'}`,
    () => `local ${generateVarName(lite)}="${randomString(lite?8:16)}";${lite?'':'\n'}`,
    () => `local ${generateVarName(lite)}=${encStr(randomString(lite?4:8))};${lite?'':'\n'}`,
    () => `local ${generateVarName(lite)}=function()return ${encNum(Math.floor(Math.random()*100))} end;${lite?'':'\n'}`,
    () => `local ${generateVarName(lite)}={${Array.from({length:lite?3:5},()=>encNum(Math.floor(Math.random()*100)+1)).join(",")}};${lite?'':'\n'}`,
    () => `if ${Math.random()>.5}then local ${generateVarName(lite)}=nil end;${lite?'':'\n'}`,
    () => `for ${generateVarName(lite)}=1,${encNum(Math.floor(Math.random()*8)+2)} do end;${lite?'':'\n'}`,
    () => `while false do local ${generateVarName(lite)}=true;break;end;${lite?'':'\n'}`,
    () => `local ${generateVarName(lite)}=math.max(${encNum(Math.floor(Math.random()*50))},${encNum(Math.floor(Math.random()*50))});${lite?'':'\n'}`,
    () => `local ${generateVarName(lite)}=math.abs(math.floor(${(Math.random()*1000-500).toFixed(2)}));${lite?'':'\n'}`,
    () => `local ${generateVarName(lite)}=string.rep(${encStr(randomString(2))},${encNum(Math.floor(Math.random()*4)+2)});${lite?'':'\n'}`,
    () => `local ${generateVarName(lite)}=type(${encStr(randomString(3))});${lite?'':'\n'}`,
    () => generateJunkFunction(lite),
  ];

  for (let r = 0; r < count; r++) {
    e += patterns[Math.floor(Math.random() * patterns.length)]();
  }
  return e;
}

function injectJunkIntoCode(code, intensity, lite, opts) {
  const useSalt = opts && opts.useSaltEncode;
  const useNum  = opts && opts.useNumExpr;
  const encStr  = s => useSalt ? strToEncodedChar(s) : strToChar(s);
  const encNum  = n => useNum  ? numToExpr(n) : String(n);

  const lines = code.split('\n');
  const result = [];
  for (let i = 0; i < lines.length; i++) {
    result.push(lines[i]);
    if (Math.random() > 0.7 && intensity > 50) {
      const n = Math.floor(Math.random() * 3) + 1;
      for (let j = 0; j < n; j++) {
        const r = Math.random();
        if (r < 0.4) result.push(`local ${generateVarName(lite)}=${encNum(Math.floor(Math.random()*999)+1)};`);
        else if (r < 0.7) result.push(`local ${generateVarName(lite)}=${encStr(randomString(lite?3:6))};`);
        else result.push(generateJunkFunction(lite).replace(/\n/g, ''));
      }
    }
  }
  return result.join(lite ? '' : '\n');
}

function minifyCode(code) {
  return code
    .replace(/--\[\[[\s\S]*?\]\]/g, '')
    .replace(/--[^\n]*/g, '')
    .replace(/\n\s*\n/g, '\n')
    .replace(/[ \t]+/g, ' ')
    .trim();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ãƒ¡ã‚¤ãƒ³é›£èª­åŒ–å‡¦ç†
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function processObfuscation(inputCode, opts) {
  const TARGET_SIZE = 1.5 * 1024 * 1024;
  let a = inputCode;
  const lite = opts.useLite;
  let adjLayers = opts.layers;
  let adjJunk   = opts.junk;

  if (lite) {
    const inputSize = new Blob([inputCode]).size;
    const estSize   = inputSize * Math.pow(1.37, opts.layers);
    if (estSize > TARGET_SIZE) {
      setObfStatus("è»½é‡åŒ–: ã‚µã‚¤ã‚ºèª¿æ•´ä¸­...", "process");
      const maxSafe = Math.max(3, Math.floor(Math.log(TARGET_SIZE / inputSize) / Math.log(1.37)));
      adjLayers = Math.min(opts.layers, maxSafe);
      adjJunk   = Math.min(opts.junk, 80);
      await sleep(50);
    }
  }

  // â”€â”€ XORæš—å·åŒ– â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const XOR_DEPTH = 36;
  let xorDecoder = "", vXorVar = "";
  if (opts.useXor) {
    setObfStatus("36å±¤ Chaos XORæš—å·åŒ–ä¸­...", "process");
    await sleep(20);
    const masterSeed = Math.floor(Math.random() * 99999999) + 100000;
    let cur = masterSeed;
    const nxt = () => { cur = (cur * 1664525 + 1013904223) % 4294967296; return cur; };
    const ops = [];
    for (let i = 0; i < XOR_DEPTH; i++) {
      const r = nxt();
      ops.push({
        type: Math.floor((r % 100) / 34),
        keyBase: Math.floor((r / 256) % 255) + 1,
        prime: [2,3,5,7,11,13,17,19,23,29,31][Math.floor((r % 1000) / 100)] || 3
      });
    }
    const bytes = new Uint8Array(a.length);
    for (let i = 0; i < a.length; i++) bytes[i] = a.charCodeAt(i);
    for (let pass = 0; pass < XOR_DEPTH; pass++) {
      const { type: tp, keyBase: k, prime: p } = ops[pass];
      for (let i = 0; i < bytes.length; i++) {
        const dk = (k * (i + p)) % 256;
        if (tp === 0) bytes[i] = bytes[i] ^ dk;
        else if (tp === 1) bytes[i] = (bytes[i] + dk) % 256;
        else bytes[i] = (bytes[i] - dk + 256) % 256;
      }
      if (pass % 5 === 0) updateObfProgress((pass / XOR_DEPTH) * 30);
    }
    let enc = "";
    const cs = 32768;
    for (let i = 0; i < bytes.length; i += cs)
      enc += String.fromCharCode.apply(null, bytes.subarray(i, i + cs));
    a = enc;

    vXorVar = generateVarName(lite);
    xorDecoder = `\nlocal function ${vXorVar}(str)\n` +
      `local b={}\n` +
      `for i=1,#str do b[i]=string.byte(str,i) end\n` +
      `local s=${masterSeed}\n` +
      `local function n() s=(s*1664525+1013904223)%4294967296 return s end\n` +
      `local ops={}\nlocal pr={2,3,5,7,11,13,17,19,23,29,31}\n` +
      `for i=1,${XOR_DEPTH} do\n` +
      `local r=n()\n` +
      `local t=math.floor((r%100)/34)\n` +
      `local k=math.floor((r/256)%255)+1\n` +
      `local p=pr[math.floor((r%1000)/100)+1] or 3\n` +
      `table.insert(ops,{t,k,p})\nend\n` +
      `for pass=${XOR_DEPTH},1,-1 do\n` +
      `local op=ops[pass]\nlocal t,k,p=op[1],op[2],op[3]\n` +
      `for i=1,#b do\nlocal dk=(k*(i+p))%256\n` +
      `if t==0 then b[i]=bit32.bxor(b[i],dk)\n` +
      `elseif t==1 then b[i]=(b[i]-dk+256)%256\n` +
      `elseif t==2 then b[i]=(b[i]+dk)%256 end\n` +
      `end\nend\n` +
      `local r={}\nfor i=1,#b do r[i]=string.char(b[i]) end\n` +
      `return table.concat(r)\nend\n`;
  }

  // â”€â”€ Base64 å¤šå±¤ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  for (let i = 0; i < adjLayers; i++) {
    updateObfProgress(30 + (i / adjLayers) * 60);
    if (i % 5 === 0) await sleep(10);
    try { a = btoa(a); }
    catch (err) {
      const b = new Uint8Array(a.length);
      for (let j = 0; j < a.length; j++) b[j] = a.charCodeAt(j);
      a = bytesToBase64(b);
    }
  }

  // â”€â”€ å¤‰æ•°åæº–å‚™ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const vLib = generateVarName(lite);
  const vStr = generateVarName(lite);
  const vTbl = generateVarName(lite);
  const vVM  = generateVarName(lite);
  const vSt  = generateVarName(lite);
  const dv1  = generateVarName(lite);
  const dv2  = generateVarName(lite);
  const dv3  = generateVarName(lite);

  // â”€â”€ Base64ãƒ‡ã‚³ãƒ¼ãƒ€ç”Ÿæˆ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const b64Decoder = lite
    ? `local ${dv1}='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/='` +
      `local ${dv2}={}for ${dv3}=1,#${dv1} do ${dv2}[string.byte(${dv1},${dv3},${dv3})]=${dv3}-1 end ` +
      `local function ${vLib}(s)local r,p,n={},1,#s for i=1,n,4 do ` +
      `local a,b,c,d=${dv2}[string.byte(s,i,i)],${dv2}[string.byte(s,i+1,i+1)],${dv2}[string.byte(s,i+2,i+2)],${dv2}[string.byte(s,i+3,i+3)]` +
      `if not a or not b then break end r[p]=string.char((a*4+math.floor(b/16))%256)p=p+1 ` +
      `if not c then break end r[p]=string.char(((b%16)*16+math.floor(c/4))%256)p=p+1 ` +
      `if not d then break end r[p]=string.char(((c%4)*64+d)%256)p=p+1 end return table.concat(r)end`
    : `local ${dv1}='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/='\n` +
      `local ${dv2}={}\n` +
      `for ${dv3}=1,#${dv1} do ${dv2}[string.byte(${dv1},${dv3},${dv3})]=${dv3}-1 end\n` +
      `local function ${vLib}(s)local r,p,n={},1,#s\n` +
      `for i=1,n,4 do local a,b,c,d=${dv2}[string.byte(s,i,i)],${dv2}[string.byte(s,i+1,i+1)],${dv2}[string.byte(s,i+2,i+2)],${dv2}[string.byte(s,i+3,i+3)]\n` +
      `if not a or not b then break end\n` +
      `r[p]=string.char((a*4+math.floor(b/16))%256)p=p+1\n` +
      `if not c then break end\n` +
      `r[p]=string.char(((b%16)*16+math.floor(c/4))%256)p=p+1\n` +
      `if not d then break end\n` +
      `r[p]=string.char(((c%4)*64+d)%256)p=p+1 end\n` +
      `return table.concat(r)end\n`;

  // â”€â”€ å‡ºåŠ›æ§‹ç¯‰ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  let out = lite ? '' : '-- [[ ã“ã®ä¸–ç•Œä¸€å¼±ã„é›£èª­åŒ–ã¯é‡ç£ã«ã‚ˆã£ã¦æ–½ã•ã‚Œã¾ã—ãŸ ]] --\n';

  // ã‚¢ãƒ³ãƒãƒ€ãƒ³ãƒ—
  if (opts.useAntiDump) {
    const a1 = generateVarName(lite), a2 = generateVarName(lite), a3 = generateVarName(lite);
    out += `local function ${a1}()` +
      `local ${a2}=getfenv()` +
      `local ${a3}=${a2}[${strToChar("getgenv")}]` +
      `if ${a3} then ` +
        `${a3}()[${strToChar("saveinstance")}]=nil ` +
        `${a3}()[${strToChar("save_instance")}]=nil ` +
        `${a3}()[${strToChar("dumpstring")}]=nil ` +
      `end ` +
      `if debug then ` +
        `if debug.sethook then pcall(function()debug.sethook(function()while true do end end,"c")end)end ` +
        `if debug.getinfo then debug.getinfo=nil end ` +
      `end ` +
      `end pcall(${a1})` + (lite ? '' : '\n');
  }

  // ã‚¸ãƒ£ãƒ³ã‚¯ã‚³ãƒ¼ãƒ‰ (å‰éƒ¨)
  if (adjJunk > 0) {
    out += generateMassiveJunkCode(Math.floor(adjJunk / (lite ? 20 : 5)), lite, opts);
  }
  // ã‚´ãƒŸé–¢æ•°è¿½åŠ æ³¨å…¥
  if (opts.useJunkFunc && !lite) {
    const jfCount = Math.floor(adjJunk / 30) + 3;
    for (let i = 0; i < jfCount; i++) out += generateJunkFunction(lite);
  }

  out += b64Decoder + (lite ? '' : '\n');
  if (opts.useXor && xorDecoder) out += lite ? xorDecoder.replace(/\n/g, '') : xorDecoder + '\n';

  // ã‚·ãƒ£ãƒƒãƒ•ãƒ« or ç›´æ¥é…ç½®
  if (opts.useShuffle) {
    const chunks = [];
    for (let i = 0; i < a.length; i += 500) chunks.push(a.substring(i, i + 500));
    let arr = chunks.map((v, i) => ({ v, i }));
    for (let i = arr.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    const vIdx = generateVarName(lite);
    let tbl = '{';
    arr.forEach(x => { tbl += `[${x.i + 1}]="${x.v}",`; });
    tbl += '}';
    out += lite
      ? `local ${vTbl}=${tbl}local ${vStr}=""for ${vIdx}=1,${arr.length} do ${vStr}=${vStr}..${vTbl}[${vIdx}]end`
      : `local ${vTbl}=${tbl}\nlocal ${vStr}=""\nfor ${vIdx}=1,${arr.length} do ${vStr}=${vStr}..${vTbl}[${vIdx}]end\n`;
  } else {
    out += lite ? `local ${vStr}="${a}"` : `local ${vStr}="${a}"\n`;
  }

  // ãƒ‡ã‚³ãƒ¼ãƒ‰ + å®Ÿè¡Œ
  if (opts.useFlat) {
    const steps = [];
    for (let i = 0; i < adjLayers; i++) steps.push(`${vStr}=${vLib}(${vStr})`);
    if (opts.useXor && vXorVar) steps.push(`${vStr}=${vXorVar}(${vStr})`);
    steps.push(`local f=loadstring(${vStr})if f then f()end return`);
    let vm = '{';
    for (let i = 0; i < steps.length; i++)
      vm += `[${i}]=function()${steps[i]} return ${i === steps.length - 1 ? -1 : i + 1}end,`;
    vm += '}';
    out += lite
      ? `local ${vSt}=0 local ${vVM}=${vm}while ${vSt}~=-1 do ${vSt}=${vVM}[${vSt}]()end`
      : `local ${vSt}=0\nlocal ${vVM}=${vm}\nwhile ${vSt}~=-1 do ${vSt}=${vVM}[${vSt}]()end`;
  } else {
    for (let i = 0; i < adjLayers; i++)
      out += lite ? `${vStr}=${vLib}(${vStr})` : `${vStr}=${vLib}(${vStr})\n`;
    if (opts.useXor && vXorVar)
      out += lite ? `${vStr}=${vXorVar}(${vStr})` : `${vStr}=${vXorVar}(${vStr})\n`;
    out += `loadstring(${vStr})()`;
  }

  // ã‚¸ãƒ£ãƒ³ã‚¯ã‚³ãƒ¼ãƒ‰æ³¨å…¥ (å¾Œéƒ¨)
  if (adjJunk > 100) out = injectJunkIntoCode(out, adjJunk, lite, opts);
  if (lite) out = minifyCode(out);

  return out;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  é›£èª­åŒ–ãƒœã‚¿ãƒ³
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function startObfuscation() {
  const code = byId('obfInput').value;
  if (!code.trim()) { setObfStatus("ã‚¨ãƒ©ãƒ¼: ã‚³ãƒ¼ãƒ‰ãŒç©ºã§ã™", "error"); return; }

  const btn = byId('btnObfuscate');
  btn.disabled = true;
  updateObfProgress(0);

  try {
    const opts = {
      layers:         parseInt(byId('b64Layers').value),
      junk:           parseInt(byId('junkIntensity').value),
      useXor:         byId('chkXor').checked,
      useShuffle:     byId('chkShuffle').checked,
      useFlat:        byId('chkFlat').checked,
      useAntiDump:    byId('chkAntiDump').checked,
      useSaltEncode:  byId('chkSaltEncode').checked,
      useNumExpr:     byId('chkNumExpr').checked,
      useJunkFunc:    byId('chkJunkFunc').checked,
      useLite:        byId('chkLite').checked,
    };
    setObfStatus("å‡¦ç†ä¸­...", "process");
    const result = await processObfuscation(code, opts);
    byId('obfOutput').value = result;
    const sz = new Blob([result]).size;
    const szStr = sz >= 1048576 ? `${(sz/1048576).toFixed(2)} MB`
                : sz >= 1024   ? `${(sz/1024).toFixed(2)} KB`
                :                `${sz} bytes`;
    setObfStatus(`âœ“ å®Œäº† (${szStr})`, "success");
    updateObfProgress(100);
  } catch (e) {
    setObfStatus("ã‚¨ãƒ©ãƒ¼: " + e.message, "error");
    console.error(e);
  } finally {
    btn.disabled = false;
    setTimeout(() => { byId('obfProgress').style.display = 'none'; }, 2000);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  è§£èª­ãƒœã‚¿ãƒ³ (ã‚µãƒ¼ãƒãƒ¼APIå‘¼ã³å‡ºã—)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function startDeobfuscation() {
  const code = byId('deobfInput').value;
  if (!code.trim()) { setDeobfStatus("ã‚¨ãƒ©ãƒ¼: ã‚³ãƒ¼ãƒ‰ãŒç©ºã§ã™", "error"); return; }

  const btn = byId('btnDeobfuscate');
  btn.disabled = true;
  byId('deobfOutput').value = '';
  byId('deobfLoader').style.display = 'block';
  setDeobfStatus("ã‚µãƒ¼ãƒãƒ¼ã§Luaã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œä¸­...", "process");

  try {
    const res  = await fetch('/api/deobfuscate', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ code })
    });
    const data = await res.json();
    if (data.success) {
      byId('deobfOutput').value = data.result;
      setDeobfStatus("âœ“ è§£èª­å®Œäº†ï¼", "success");
    } else {
      byId('deobfOutput').value = 'ã‚¨ãƒ©ãƒ¼:\n' + data.error;
      setDeobfStatus("âŒ " + data.error, "error");
    }
  } catch (e) {
    setDeobfStatus("âŒ ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼: " + e.message, "error");
  } finally {
    btn.disabled = false;
    byId('deobfLoader').style.display = 'none';
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ã‚¤ãƒ™ãƒ³ãƒˆç™»éŒ²
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
byId('btnObfuscate').addEventListener('click', startObfuscation);
byId('btnDeobfuscate').addEventListener('click', startDeobfuscation);
byId('btnObfCopy').addEventListener('click', () => {
  byId('obfOutput').select();
  document.execCommand('copy');
  setObfStatus('ğŸ“‹ ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼', 'success');
});
byId('btnDeobfCopy').addEventListener('click', () => {
  byId('deobfOutput').select();
  document.execCommand('copy');
  setDeobfStatus('ğŸ“‹ ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼', 'success');
});
</script>
</body>
</html>
